---
layout: post
title: "MongoDB基础"
date: 2014-01-10 
categories: DB 基础
tags: MongoDB 基础
updateTime: 2021-05-31 
---

* content
{:toc}
## Mongo 基础

### 1.基本信息及意义

[MongoDB ](https://baike.baidu.com/item/mongodb/60411?fr=aladdin) 是一个基于分布式文件存储的数据库 (4.4版本支持事务)。

### 2.安装

[参照菜鸟教程](https://www.runoob.com/redis/redis-tutorial.html)

```dockerfile
# 基于dockerlearn 打包 （官网基础上添加了上海时间：mongo/4.4）
# 进入dockerfile文件的目录 无密码
docker build -t meizhangzheng/mongo .

#启动  无密码
docker run --name mongo -v /usr/meizhangzheng/data/mongo:/data/db -p 27017:27017 -d meizhangzheng/mongo:4.4 
```

- 如果多次安装，注意清除原文件

- 目录权限 :读写   打包前 ``` chmod +x  docker-entrypoint.sh ```

- 容器内部常用命令不起作用，需重新安装

  ```sh
  apt-get update && apt-get install -y vim
  ```

- 默认没有用户名与密码

- 如果启动命令中添加：--auth ，则创建用户后，登录需要密码。  [mongo设置用户与密码](https://blog.csdn.net/weixin_41238134/article/details/100069106)

  ```sql
  # 带密码登录 --auth
  docker run --name mongo -v /usr/meizhangzheng/mongo/data:/data/db -p 27017:27017 -d meizhangzheng/mongo:4.4 --auth 
  
  #创建用户及权限
  db.createUser({ user:'admin',pwd:'xsj+q',roles:[ { role:'userAdminAnyDatabase', db: 'admin'},{ role:'dbOwner', db: 'admin'}]});
  
  # 使用户生效
  db.auth("admin","xsj+q");
  
  # 权限： 为某个用户添加 dbOwner（包含readWrite、dbAdmin、userAdmin），作用于哪个数据库  (确保数据库存在)
  # 一般用户： 读写权限即可  db.createUser({ user:'mzz',pwd:'123456',roles:[ { role:'readWrite', db: 'admin'}]});
  > db.grantRolesToUser("admin",[{role:"dbOwner",db:"admin"}])
  > db.grantRolesToUser("admin",[{role:"dbOwner",db:"mylog"}])
  > db.grantRolesToUser("admin",[{role:"dbOwner",db:"my_customer"}]
                                              
  # 通过客户端连接时，就需要用户名与密码、通过容器登录也需要密码
  # docker exec -it mongo bash
  # mongo -u admin -p xsj+q 库名
  # db
  # show users
  
  # 创建数据库
  use mylog
  # 创建用户
  db.createUser({ user:'mzz',pwd:'123456',roles:[ { role:'readWrite', db: 'mylog'}]});
  db.auth("mzz","123456")
  # 如果mylog 没有数据，则不会创建该集合（数据库）
  show dbs #不能查看mylog
  ```

### 3.基本操作	

```sql
#进入容器
docker exec -it mongo bash

#访问某一数据库
root@8cc31ea24bb0:/# mongo -u mzz -p 123456 mylog

#执行插入语句
db.mylog.insert({"name":"mzz"})
```

[docker-mongo](https://hub.docker.com/_/mongo)  、 [创建账号密码](https://www.cnblogs.com/lshan/p/11497359.html)、[mongo权限](https://www.cnblogs.com/dbabd/p/10811523.html)

### 4.常用工具


```
mongo-express : mongo web 管理端
```

### 5.问题总结

- 目录权限问题
- 用户权限问题

### 6.Mongo集群

[mongodb分布式集群](https://www.cnblogs.com/littleatp/p/8563273.html)

```
Mongodb集群架构由Mongos、Config副本集和多个分片组成；
安装过程中先初始化Config副本集、分片副本集，最后通过Mongos添加分片
Config副本集存储了集群访问的用户及角色权限，为了方便管理，可以给分片副本集添加本地用户
Mongodb提供了LocalException机制，首次安装数据库时可以在本机直接添加用
```



### 参考

[菜鸟教程](https://www.runoob.com/redis/redis-tutorial.html)

[dockerlearn](https://gitee.com/xushj/dockerlearn)

[docker-mongo](https://hub.docker.com/_/mongo)

[Mongo无法启动](https://www.it610.com/article/1283004078539948032.htm)

[mongo设置用户与密码](https://blog.csdn.net/weixin_41238134/article/details/100069106)

[mongo权限](https://www.cnblogs.com/dbabd/p/10811523.html)

[mongodb分布式集群](https://www.cnblogs.com/littleatp/p/8563273.html)